---
title: "Run analysis"
author: "Adelaide Currin, Jennah Gosciak"
date: "2022-11-05"
output: html_document
---

```{r, setup}
library(tidyverse)
library(rlang)
library(fs)
library(tidycensus)
library(lehdr)
library(sf)
library(readxl)
data_dir <- "C:/Users/Jennah/Desktop/Code/RMproject"
```

```{r}
merged_oz <- readRDS("../2_output/analysis_file.RDS") %>% 
  mutate(across(C000rac:CS02wac, ~if_else(is.na(.), 0, .))) %>% 
  mutate(poverty_rate = povertystatus / povertystatus_denom)

cov <- c("medfamincome", "poverty_rate")
```

```{r}
run_model_outcome <- function(outcome, data=merged_oz, covariates=cov) {
  covariates <- str_c(covariates, collapse = " + ")
  print(str_c("Running model for ", outcome))
  mod <- lm(str_c(outcome, "~ year + year:treatment:post + post:treatment + post + treatment + ", covariates), data = data)
  summary(mod) %>% 
    print()
  
  return(mod)
}

walk(c("C000rac", "C000wac",
       "CA01rac","CA01wac",
       "CE01rac", "CE01wac",
       "S000_same_tract", "S000_desig", "S000_elig"), ~run_model_outcome(.))
```